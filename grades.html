<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Calendagenda :: Grades</title>

    <!-- Bootstrap for Mobile-first -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Optional styles and scripts of your own -->

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

    <link rel="stylesheet" href="styles/style.css">
    <script src="scripts/script.js"></script>
    <script src="scripts/firebase_config.js"></script>

    <style>
        body {
            background-image: url(images/white.jpg);
        }

        .content {
            text-align: center;
            margin: 5vh;

        }

        .card {
            margin: 1.5vh;
            height: 1000px;
            width: 95%;
            margin-top: 50px;

        }

        .card-deck {
            display: block;


        }


        .btn-outline-secondary {
            width: 100%;
            margin: 1.5vh;

        }

        .selection {
            border: 1px solid gray;
            padding: 1.5vh;
            padding-right: 30px;
            border-radius: 3%
        }

        .form-control {

            text-align: center;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
            data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#!">Calendagenda</a>

        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="navbar-nav mr-auto mt-2 mt-md-0">
                <li class="nav-item active">
                    <a class="nav-link" href="main.html">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="calendar.html">Calendar</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="grades.html">Grades</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="officehours.html">Office Hours</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="courseinfomation.html">Course Information</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="loginpage.html" onclick="logoutUser()" id="logout">Log out</a>
                </li>
            </ul>
        </div>
    </nav>



    <div class="content">

        <p>Pick the Course</p>
        <h1>Grades <br><br></h1>

        <div class="selection">
            <a href="#comp-1510" class="btn btn-outline-secondary">COMP 1510</a>
            <a href="#comp-1712" class="btn btn-outline-secondary">COMP 1712</a>
            <a href="#comp-1536" class="btn btn-outline-secondary">COMP 1536</a>
            <a href="#comp-1930" class="btn btn-outline-secondary">COMP 1930</a>
            <a href="#comp-1100" class="btn btn-outline-secondary">COMP 1100</a>
            <a href="#comp-1113" class="btn btn-outline-secondary">COMP 1113</a>
            <a href="#comm-1116" class="btn btn-outline-secondary">COMM 1116</a>

        </div>

        <div class="card-deck">
            <div id="comp-1510" class="card">
                <h3 class="card-header">COMP 1510</h3>
                <div class="card-body">
                    <h4 class="card-prof-name">Bruce Link</h4>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"
                        data-whatever="quiz">Submit Quiz Marks</button>
                    <br>
                    <p class="card-text">Quiz 1: <span id="quiz1">test1</span></p>
                    <p class="card-text">Quiz 2: <span id="quiz2">test2</span></p>
                    <p class="card-text">Quiz 3: <span id="quiz3">test3</span></p>
                    <p class="card-text">Average of the quizzes: <span id="averageQuizzes">Average</span></p>



                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">COMP 1510</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="form-group">
                                            <label>Quiz Number</label>
                                            <select size="1" name="experience" id="experience" class="form-control">
                                                <option value="Quiz 1" selected="selected">Quiz 1</option>
                                                <option value="Quiz 2">Quiz 2</option>
                                                <option value="Quiz 3">Quiz 3</option>

                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="message-text" id="mark" class="col-form-label">Marks</label>
                                            <textarea class="form-control" id="message-text"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" id="submit" class="btn btn-primary" data-dismiss="modal">Submit Grade</button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>



        </div>



    </div>

    <script>
        //submit button does this stuff: 
        setAddListener();
        getAverage("1510", "quizzes");

        //Adds quiz and its grade into the database 
        //DOESNT UPDATE grade / duplicate quizzes
        function setAddListener() {
            document.getElementById("submit").addEventListener("click", function (e) {
                //Variables for different types of course and assessments
                let course = "1510";
                let type = "quizzes";
                let quiznum = document.getElementById("experience").value;
                let grade = document.getElementById("message-text").value;
                console.log("PRESSED! " + quiznum + " " + grade);

                firebase.auth().onAuthStateChanged(function (user) {
                    console.log(user.uid);
                    db.collection("users").doc(user.uid).collection("grades").doc(course)
                        .collection(type)
                        .add({
                            name: quiznum,
                            mark: grade
                        })
                });

            });
        }

        showQuizMarks();

        function showQuizMarks() {
            firebase.auth().onAuthStateChanged(function (user) {
                db.collection("users").doc(user.uid).collection("grades").doc("1510").collection("quizzes")
                    .get().then(function (snap) {
                        var counter = 1;
                        snap.forEach(function (doc) {
                            var mark = doc.data().mark;
                            document.getElementById("quiz" + counter).innerHTML = mark;
                            counter++;
                        })
                    });
            })
        }

        function getAverage(course, type) {
            firebase.auth().onAuthStateChanged(function (user) {
                var dbRef = db.collection('users').doc(user.uid).collection("grades").doc(course)
                    .collection(type);
                let sum = 0;
                let totalQuiz = 0.0;
                dbRef.onSnapshot(function (snap) {
                    //Checks each document in the collection(QUIZZES)
                    snap.forEach(function (doc) {
                        var mark = Number(doc.data().mark);
                        console.log(doc.data().name + " ", mark);
                        sum += mark;

                        totalQuiz++

                    });

                    console.log("sum of marks ", sum);
                    let average = sum / totalQuiz;
                    console.log("AVERAGE ", average);
                    document.getElementById("averageQuizzes").innerHTML = average;

                });

            });
        }
    </script>


</body>

</html>